<p>JavaScript is the bane of a web scraper&#39;s life. Scraping is all about extracting data from a web page and JavaScript is there adding content, hiding blocks, and moving the DOM around. Reading the HTML from the server is just not enough. What you ideally want is a way to run all that JavaScript on the page so you can see what&#39;s left after that. Then you can get down to some serious scraping.</p>
<p>There are tools to do this out there but most have their own complications or restrictions that make them difficult to deploy. Puppeteer has none of those problems and with <a href="https://fly.io">Fly</a>, you can deploy puppeteer based applications close to your users. At its core, this project is a puppeteer-based service. <a href="https://pptr.dev/">Puppeteer</a> is a package that renders pages using a headless Chrome instance, executing the JavaScript within the page.</p>
<h2 id='quick-start' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#quick-start' aria-label='Anchor'></a>Quick Start</h2><p>A typical YouTube page will add the views count to itself only when the JavaScript on that page executes. These are the types of use cases where Puppeteer comes in very handy. Puppeteer can execute the JavaScript on the YouTube page and, from the rendered page, extract the view count and the title of the video.</p>
<p>Lets get started</p>
<h3 id='install-example-project' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#install-example-project' aria-label='Anchor'></a>Install Example Project</h3><p>To install this project locally, execute the following commands:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>git clone https://github.com/fly-examples/puppeteer-js-renderer.git
cd puppeteer-js-renderer
npm install
</code></pre></div><h3 id='your-first-scraper' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#your-first-scraper' aria-label='Anchor'></a>Your First Scraper</h3><p>To quickly try the project out after installing it, run the command below:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>node yt-views.js
</code></pre></div><p>This will show something like below:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>Pulling views from YouTube, please wait...
Luis Fonsi - Despacito ft. Daddy Yankee has 6,881,463,846 views
</code></pre></div><p>If you want to try any other video just pass the YouTube video URL as a parameter to the script like below:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>node yt-views https://www.youtube.com/watch?v=XqZsoesa55w
</code></pre></div><p>It should give you an output like this:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>Pulling views from YouTube, please wait...
Baby Shark Dance | Sing and Dance! | @Baby Shark Official | PINKFONG Songs for Children has 6,077,338,169 views
</code></pre></div><h3 id='what-just-happened-here' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#what-just-happened-here' aria-label='Anchor'></a>What Just Happened Here?</h3><p>To show the YouTube video views count, a small scraper written with <a href="https://www.npmjs.com/package/@geshan/axrio">Axrio</a> npm package was executed. Axrio combines the popular <a href="https://www.npmjs.com/package/axios">Axios</a> library and <a href="https://www.npmjs.com/package/cheerio">Cheerio</a> to create a mini scraper. Axios is used to make requests and Cheerio acts like DOM navigator parsing the markup and giving us an API for traversing/manipulating the resulting data structure. You can kickstart a small scraper with Axrio too.</p>
<p>The <a href="./yt-views">yt-views.js</a> is a basic scraper which performs a GET request for the given YouTube URL with Puppeteer. This will return the final DOM after the page&#39;s JavaScript executes. Then it parses the title and views count out of the rendered page&#39;s markup and prints it on the console.</p>
<p>It uses the puppeteer-js-renderer service that is already deployed and running on Fly.io. Have a look at he &quot;<a href="#how-to-use-it-as-a-service">how to use it as a service</a>&quot; section for more information. To start your own instance on Fly.io jump to the &quot;<a href="#how-to-deploy-it-on-flyio">how to deploy on fly.io</a>&quot; section.</p>
<h2 id='run-locally' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#run-locally' aria-label='Anchor'></a>Run Locally</h2><p>If you have node installed on your machine, you already cloned this repository and ran <code>npm install</code>. Now run <code>npm start</code> to get this service running locally.</p>
<p>The next step is to navigate to <code>http://localhost:8080/api/render?url=https://www.youtube.com/watch?v=kJQP7kiw5Fk</code> on your browser to view the JavaScript rendered output.</p>
<h3 id='run-with-docker' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#run-with-docker' aria-label='Anchor'></a>Run With Docker</h3><p>If you want to run with Docker, execute the following after you clone the repository:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>cd puppeteer-js-renderer
docker-compose up
</code></pre></div><p>Then go to <code>http://localhost:8080/api/render?url=https://www.youtube.com/watch?v=kJQP7kiw5Fk</code> in your browser to see the output.</p>
<h2 id='how-to-use-it-as-a-service' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#how-to-use-it-as-a-service' aria-label='Anchor'></a>How to Use It as a Service</h2><p>If you want to use puppeteer-js-renderer for scraping, you can use the following URL on Fly.io:</p>
<div class='highlight relative group '><button class='group-hover:opacity-100 opacity-0 transition-all absolute right-0 top-0 z-20 w-12 h-12 p-4 text-gray-400 hover:text-white z-10 outline-none focus:outline-none' aria-label='Copy' data-copy-target='sibling' data-copy-success="%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' stroke-linecap='round' stroke-width='2' stroke='white' fill='none' stroke='currentColor' %3E%3Cpath d='m16.376 7.924-6.043 8.095-2.895-3.354' /%3E%3Cpath d='M6 2h12c2.208 0 4 1.792 4 4v12c0 2.208-1.792 4-4 4H6c-2.208 0-4-1.792-4-4V6c0-2.208 1.792-4 4-4Z' /%3E%3C/svg%3E"><svg class='pointer-events-none' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M15.79 10.869a2.66 2.66 0 0 0-2.659-2.659H5.154a2.66 2.66 0 0 0-2.659 2.659v7.977a2.66 2.66 0 0 0 2.659 2.659h7.977a2.66 2.66 0 0 0 2.659-2.659v-7.977Z' /><path d='M15.79 15.758h3.089a2.661 2.661 0 0 0 2.659-2.66V5.121a2.661 2.661 0 0 0-2.659-2.659h-7.977a2.661 2.661 0 0 0-2.66 2.659v2.368' /></svg></button><pre class='highlight '><code>https://js-renderer-fly.fly.dev/api/render?url=https://www.youtube.com/watch?v=kJQP7kiw5Fk
</code></pre></div><p>The YouTube URL is an example above, you can use any URL that needs javascript to be executed to be functional.</p>
<h3 id='styles-broken' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#styles-broken' aria-label='Anchor'></a>Styles Broken</h3><p>Styles and images will look broken but the HTML tags will be there. Happy Web Scraping!</p>
<h2 id='how-to-deploy-it-on-fly-io' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#how-to-deploy-it-on-fly-io' aria-label='Anchor'></a>How to Deploy It on fly.io</h2><p><a href="https://fly.io">Fly.io</a> is a platform for applications that need to run globally. It runs your code close to users and scales compute in cities where your app is busiest. Write your code, package it into a Docker image, deploy it to Fly&#39;s platform, and let that do all the work to keep your app snappy.</p>
<p>Fly.io has great <a href="https://fly.io/docs/">documentation</a> to get started. You can find a quick speed run showing how to get your app running closer to your users with this <a href="https://fly.io/docs/speedrun/">guide</a>.</p>
<p>Please follow these steps to deploy your own puppeteer-js-renderer service on Fly.io:</p>
<h3 id='prerequisites' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#prerequisites' aria-label='Anchor'></a>Prerequisites</h3>
<ol>
<li><a href="https://fly.io/docs/getting-started/installing-flyctl/">Install</a> the flyctl CLI command.
</li><li>Register on fly with <code>flyctl auth signup</code>, if you already have a fly account log in with <code>flyctl auth login</code>.
</li></ol>
<h3 id='steps' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#steps' aria-label='Anchor'></a>Steps</h3>
<ol>
<li>Clone this repo with <code>git clone git@github.com:fly-examples/puppeteer-js-renderer.git</code> if you are logged in with SSH support enabled. Otherwise try <code>git clone https://github.com/fly-examples/puppeteer-js-renderer.git</code>.
</li><li>Then run <code>cd puppeteer-js-renderer</code>.
</li><li>After that execute <code>flyctl init --dockerfile</code> and when asked for an app name, hit return to have one generated (unless there&#39;s a name you really want). I ran it with js-renderer-fly as the app name for this example.
</li><li>Subsequently, you can select an organization. Usually this will be your first name-last name on the prompt.
</li><li>It should create a fly.toml file in the project root (I have not committed it, it is in .gitignore).
</li><li>Now run <code>flyctl deploy</code> to deploy the app. It will build the docker image, push it to the fly docker image registry and deploy it. In the process of deploying it, it will display information about the number of instances and their health.
</li><li>You can then run <code>flyctl info</code>. This will give the details of the app including hostname.
</li><li>You can view your app in the browser with <code>flyctl open</code>. For me, it opened <code>https://js-renderer-fly.fly.dev</code> and displays <code>{message: &quot;alive&quot;}</code>.
</li><li>Add <code>/api/render?url=https://www.youtube.com/watch?v=kJQP7kiw5Fk</code> on the address bar of your browser after your puppeteer-js-renderer URL. Mine looked like <code>https://js-renderer-fly.fly.dev/api/render?url=https://www.youtube.com/watch?v=kJQP7kiw5Fk</code>. This will render the final DOM of that YouTube page after the JavaScript is executed.
</li><li>Enjoy!
</li></ol>
<p>The YouTube video URL is an example and it can, of course, be replaced with other web pages which need JavaScript to work.</p>
<h2 id='more-fly-commands' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#more-fly-commands' aria-label='Anchor'></a>More Fly Commands</h2><p>You can suspend your service with <code>flyctl suspend</code>; this will pause your service until you resume it. If you try <code>flyctl status</code> after suspending it will not show any instances running. Suspending the service means all resources allocated to run the service will be deallocated, resulting in the application running nowhere. To get the instances running again execute <code>flyctl resume</code>.</p>
<h3 id='fly-default-resources' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#fly-default-resources' aria-label='Anchor'></a>Fly Default Resources</h3><p>I wanted to see what resources were allocated to the App on Fly by default. The scale commands allowed me to find it out pretty easily like below:</p>

<ol>
<li><code>flyctl scale show</code> - showed me VM Size: micro-2x
</li><li><code>flyctl scale vm</code> - showed me micro-2x is a 0.25 CPU cores with 512 MB of memory.
</li></ol>
<p>If you want to increase CPU/memory or run more instances in a particular region please refer to the official Fly docs on <a href="https://fly.io/docs/scaling/">scaling</a>.</p>
<h3 id='flying-the-app-on-3-continents' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#flying-the-app-on-3-continents' aria-label='Anchor'></a>Flying the App on 3 Continents</h3><p>Our service is running in one data center. For me, it&#39;s iad (Ashburn, Virginia) but yours will likely be different based on where you are working from. We can add instances around the world to speed up responses, let&#39;s get rolling:</p>

<ol>
<li>To see the regions available run <code>flyctl platform regions</code>, I could see regions all over the world from Oregon to Sydney.
</li><li>Let&#39;s add an instance to Australia in Sydney, to do this run <code>flyctl regions add syd</code>, yes it is that easy.
</li><li>Now check <code>flyctl status</code> and you will see an instance running in Sydney
</li><li>Let’s add one more in Europe in Amsterdam with <code>flyctl regions add ams</code>. So now we are mostly covered with the app running in 3 continents.
</li><li>Of course, you can run <code>flyctl status</code> again to see your app shining on 3 continents.
</li></ol>
