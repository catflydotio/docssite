<h1 id='rationale' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#rationale' aria-label='Anchor'></a>Rationale</h1><p>Postgres is a useful database to have as part of your Fly installation. To make it simple to install, this example takes you through all the steps necessary.</p>
<p>The resulting Postgresql installation will available over the Fly 6PN internal network to other applications and to users who have configured a Fly Wireguard VPN on their local system.</p>
<p>This Postgres configuration is good for development and small services. For mission-critical workloads, you&#39;ll want a HA configuration.</p>
<h2 id='initialize-the-fly-app' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#initialize-the-fly-app' aria-label='Anchor'></a>Initialize the Fly App</h2><p>Create your <code>fly.toml</code> file by importing the template from the repository. Run:</p>
<p><code>fly init --import fly.source.toml</code></p>
<p>You will be prompted for an app name and organization. You can hit return to generate an app name when asked.</p>
<p>Do make a note of the name of the app and the region that it will initially deploy to. You&#39;ll need the app name to connect to it, and more immediately, the region for the next step.</p>
<h2 id='create-a-volume' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#create-a-volume' aria-label='Anchor'></a>Create a Volume</h2><p>Postgres needs to be able to store and persist data on disk. For that Fly has volumes which can be created in all of the Fly regions. Each volume is region-specific and is identified by name.</p>
<p><code>fly volumes create postgres --region lhr</code></p>
<p>Would create a 10GB volume named <code>postgres</code> in the <code>lhr</code> region. Add <code>--size 20</code> to create a 20GB volume.</p>
<h2 id='set-an-initial-password' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#set-an-initial-password' aria-label='Anchor'></a>Set an Initial Password</h2><p>When Postgres initialised the database for the first time, it will use the <code>POSTGRES_PASSWORD</code> to set the password for the <code>postgres</code> super-user. To pass that to the database, we set a Fly secret with whatever password we have chosen.</p>
<p><code>fly secrets set POSTGRES_PASSWORD=&lt;SUPER-SEKRIT&gt;</code></p>
<h2 id='deploy-postgres' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#deploy-postgres' aria-label='Anchor'></a>Deploy Postgres</h2><p>We are now ready to deploy Postgresql. Run:</p>
<p><code>fly deploy</code></p>
<h2 id='connecting-to-postgres' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#connecting-to-postgres' aria-label='Anchor'></a>Connecting to Postgres</h2><p>As configured, this Postgres has no direct external connectivity.</p>
<h3 id='other-fly-apps' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#other-fly-apps' aria-label='Anchor'></a>Other Fly Apps</h3><p>When 6PN private networking is enabled for an app, the Postgres instance will be accessible on <code>&lt;appname&gt;.internal</code>. It will not require TLS as connections between apps within Fly are already encrypted.</p>
<h3 id='wireguard' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#wireguard' aria-label='Anchor'></a>Wireguard</h3><p>If you have configured Fly&#39;s Wireguard, then you can securely connect to the Postgres server using that. The address of the server will be <code>&lt;appname&gt;.internal</code>. For example, your first connection to your new Postgresql with psql would be:</p>
<p><code>psql postgres://postgres:@appname.internal/</code></p>
<h2 id='notes' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#notes' aria-label='Anchor'></a>Notes</h2>
<ul>
<li>This configuration has no direct external connectivity and is specifically for the use of other Fly apps
</li><li>This configuration is good for development and small services.
</li></ul>
<h2 id='discuss' class='group flex items-center whitespace-pre-wrap relative mt-14 mb-6 text-navy font-heading'><a class='absolute ml-[-1em] pr-[0.5em] after:hash opacity-0 group-hover:opacity-50 transition-all' href='#discuss' aria-label='Anchor'></a>Discuss</h2>
<ul>
<li>You can discuss this example on the <a href="https://community.fly.io/t/new-postgres-example/458">postgres example topic</a> on community.fly.io.
</li></ul>
